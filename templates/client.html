<!DOCTYPE html>
<html lang="en">
<head>
    <!--
        client.html
        Client html file for B3rry client
        Copyright (C) 2022  Aiden Bohlander

        This program is free software: you can redistribute it and/or modify
        it under the terms of the GNU General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.

        You should have received a copy of the GNU General Public License
        along with this program.  If not, see <https://www.gnu.org/licenses/>.
    -->
    <title>B3rry Client</title>
    <style>
        body {
            overflow: hidden;
        }
        #leftjoy {
            position: absolute;
            top: 180px;
            left: 0;
            height: 300px;
            width: 300px;
        }
        #rightjoy {
            position: absolute;
            top: 180px;
            right: 0;
            height: 300px;
            width: 300px;
        }
        img {
            width: 100%;
        }
    </style>
    <script src="../static/nipplejs.min.js"></script>
    <script>
        function $(id){
            return document.getElementById(id)
        }
    </script>
</head>
<body>
    <div id="leftjoy"></div>
    <div id="rightjoy"></div>
    <div>
        <img src="{{ url_for('stream') }}" width="100%">
    </div>
    <script>
        var leftoptions = {
            zone: $("leftjoy"),
            color: "gray",
            mode: "static",
            size: 130,
            restOpacity: 0.8,
            position: {
                top: "170px",
                left: "120px"
            }
        }
        var leftjoy = nipplejs.create(leftoptions);
        leftjoy.on("start move", function(event, data){
            data = JSON.stringify(leftjoy.get(0).frontPosition);
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/joystick?data="+data);
            xhr.send();
        });
        leftjoy.on("end", function(event, data){
            data = JSON.stringify({x: 0, y: 0});
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/joystick?data="+data);
            xhr.send();
        });
        var rightoptions = {
            zone: $("rightjoy"),
            color: "gray",
            mode: "static",
            size: 130,
            restOpacity: 0.8,
            position: {
                top: "170px",
                right: "120px"
            }
        }
        var rightjoy = nipplejs.create(rightoptions);
        rightjoy.on("start move", function(event, data){
            data = JSON.stringify(leftjoy.get(0).frontPosition);
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/pantilt?data="+data);
            xhr.send();
        });
        rightjoy.on("end", function(event, data){
            data = JSON.stringify({x: 0, y: 0});
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/pantilt?data="+data);
            xhr.send();
        });
    </script>
</body>

</html>